# DevOps –õ–∞–±–∞ 2: –æ—Ç –ø–ª–æ—Ö–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ –∫ —Ö–æ—Ä–æ—à–∏–º
---

## üê≥ –û–±—ã—á–Ω–∞—è —á–∞—Å—Ç—å: Dockerfile

–°–æ–∑–¥–∞–ª –¥–≤–∞ Dockerfile ‚Äî –ø–ª–æ—Ö–æ–π –∏ —Ö–æ—Ä–æ—à–∏–π. –í –ø–ª–æ—Ö–æ–º –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –∑–∞–≤—ë–ª –∫–∞–∫ –º–∏–Ω–∏–º—É–º —Ç—Ä–∏ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–∞, –∞ –≤ —Ö–æ—Ä–æ—à–µ–º –∏—Ö –∏—Å–ø—Ä–∞–≤–∏–ª. –í–æ—Ç –∫–∞–∫ –≤—ã–≥–ª—è–¥–µ–ª–∏ –æ–±–∞:

### –ü–ª–æ—Ö–æ–π Dockerfile

```dockerfile
FROM python:latest

WORKDIR /app

COPY ../model_api/ .

RUN pip install -r requirements.txt

CMD ["python", "main.py"]
```

### –•–æ—Ä–æ—à–∏–π Dockerfile

```dockerfile
FROM python:3.11-bookworm

WORKDIR /app

RUN --mount=type=bind,source=../model_api/requirements.txt,target=/tmp/requirements.txt \
    pip install --requirement /tmp/requirements.txt

COPY ../model_api/ .

CMD ["python", "main.py"]
```

---

## –ü–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤ –ø–ª–æ—Ö–æ–º Dockerfile

### 1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `latest` —Ç–µ–≥–∞ –æ–±—Ä–∞–∑–∞**

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**  
–ö—Ç–æ –∑–Ω–∞–µ—Ç, —á—Ç–æ —Ç–∞–º –≤ `latest`? –°–µ–≥–æ–¥–Ω—è —ç—Ç–æ Python 3.11, –∑–∞–≤—Ç—Ä–∞ ‚Äî 3.12, –∞ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü –≤—ã—Ö–æ–¥–∏—Ç 4.0, –∏ –≤—Å—ë –ª–æ–º–∞–µ—Ç—Å—è. –≠—Ç–æ –∫–∞–∫ –æ–±–µ–¥ –≤ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–∫—É—Å–Ω–æ, –∞ –º–æ–∂–µ—Ç –∏ –Ω–µ—Ç.

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª:**  
–ó–∞–¥–∞–ª —è–≤–Ω—É—é –≤–µ—Ä—Å–∏—é: `FROM python:3.11-bookworm`. –¢–µ–ø–µ—Ä—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ.

---

### 2. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ `requirements.txt` –∫–∞–∫ —á–∞—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**  
–ó–∞—á–µ–º —Ç–∞—â–∏—Ç—å `requirements.txt` –≤–Ω—É—Ç—Ä—å –æ–±—Ä–∞–∑–∞, –µ—Å–ª–∏ –æ–Ω –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π? –≠—Ç–æ –∫–∞–∫ –±—Ä–∞—Ç—å —Å —Å–æ–±–æ–π –∫–æ—Ä–æ–±–∫—É –æ—Ç –ø–∏—Ü—Ü—ã, –∫–æ–≥–¥–∞ —É–∂–µ —Å—ä–µ–ª –ø–∏—Ü—Ü—É.

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª:**  
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `--mount=type=bind` –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ `requirements.txt`. –¢–µ–ø–µ—Ä—å –æ–Ω –Ω–µ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.

---

### 3. **–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–∏—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤**

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**  
–ö–æ–ø–∏—Ä—É–µ–º –≤—Å—é –ø–∞–ø–∫—É `model_api`, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ –Ω–µ–π –µ—Å—Ç—å –ª–∏—à–Ω–µ–µ ‚Äî `.git`, `.md`, –ª–æ–≥–∏ –∏ —Ç.–¥. –≠—Ç–æ –∫–∞–∫ –∑–∞–ª–∏–≤–∞—Ç—å –≤ —á–µ–º–æ–¥–∞–Ω –≤—Å—ë –ø–æ–¥—Ä—è–¥, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ.

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª:**  
–°–æ–∑–¥–∞–ª `.dockerignore` —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤–∏–ª —Ç—É–¥–∞ –≤—Å—ë –Ω–µ–Ω—É–∂–Ω–æ–µ. –¢–µ–ø–µ—Ä—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ.

---

## –ü–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏

### 1. **–ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –æ—Ç –∏–º–µ–Ω–∏ root**

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**  
–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É, –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–π —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ. –≠—Ç–æ –∫–∞–∫ –¥–∞–≤–∞—Ç—å –∫–ª—é—á–∏ –æ—Ç –∫–≤–∞—Ä—Ç–∏—Ä—ã –ø–µ—Ä–≤–æ–º—É –≤—Å—Ç—Ä–µ—á–Ω–æ–º—É –Ω–∞ —É–ª–∏—Ü–µ.

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**  
–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Dockerfile –∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –Ω–µ–≥–æ —Å –ø–æ–º–æ—â—å—é `USER`.

---

### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `docker exec` –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏**

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**  
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏. –ï—Å–ª–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω—É–∂–Ω–æ –ª–µ–∑—Ç—å –≤–Ω—É—Ç—Ä—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–º–∞–Ω–¥—É —á–µ—Ä–µ–∑ `exec`, —ç—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏.

**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:**  
–í—Å—ë –¥–æ–ª–∂–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `CMD` –∏–ª–∏ `ENTRYPOINT`. –ù–∏–∫–∞–∫–∏—Ö "–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π".

---

## –°–ª–æ–∂–Ω–∞—è —á–∞—Å—Ç—å: Docker Compose

–°–æ–∑–¥–∞–ª –¥–≤–∞ compose-—Ñ–∞–π–ª–∞ ‚Äî –ø–ª–æ—Ö–æ–π –∏ —Ö–æ—Ä–æ—à–∏–π. –í –ø–ª–æ—Ö–æ–º –∑–∞–≤—ë–ª –∫–∞–∫ –º–∏–Ω–∏–º—É–º —Ç—Ä–∏ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–∞, –∞ –≤ —Ö–æ—Ä–æ—à–µ–º –∏—Ö –∏—Å–ø—Ä–∞–≤–∏–ª. –í–æ—Ç –∫–∞–∫ –æ–Ω–∏ –≤—ã–≥–ª—è–¥—è—Ç:

### –ü–ª–æ—Ö–æ–π docker-compose.yml

```yaml
version: '3'

services:
  web:
    build: .
    ports:
      - "5000:5000"
    environment:
      - SECRET_KEY=mysecretpassword123
```

### –•–æ—Ä–æ—à–∏–π docker-compose.yml

```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "5000:5000"
    env_file:
      - .env
    secrets:
      - secret_key

secrets:
  secret_key:
    file: secrets/secret_key.txt
```

---

## –ü–ª–æ—Ö–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –≤ –ø–ª–æ—Ö–æ–º docker-compose.yml

### 1. **–•–∞—Ä–¥–∫–æ–¥ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**  
–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ª–µ–∂–∞—Ç –ø—Ä—è–º–æ –≤ —Ñ–∞–π–ª–µ. –ï—Å–ª–∏ —Ñ–∞–π–ª –ø–æ–ø–∞–¥—ë—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî –≤—Å—ë, —Å–µ–∫—Ä–µ—Ç –Ω–µ —Å–µ–∫—Ä–µ—Ç.

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª:**  
–ü–µ—Ä–µ–Ω—ë—Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env` –∏ —Å–µ–∫—Ä–µ—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã. –¢–µ–ø–µ—Ä—å `docker-compose` –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –∏–∑–≤–Ω–µ.

---

### 2. **–ù–µ—É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å–µ–∫—Ä–µ—Ç—ã**

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**  
–ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –∂—ë—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω—ã, –∏—Ö —Å–ª–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø. –≠—Ç–æ –∫–∞–∫ –ø–∞—Ä–æ–ª—å –≤ –∫–æ–¥–µ ‚Äî –ø–ª–æ—Ö–∞—è –∏–¥–µ—è.

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª:**  
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `secrets` –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `secrets/secret_key.txt`. –¢–µ–ø–µ—Ä—å —Å–µ–∫—Ä–µ—Ç—ã –º–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

---

### 3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**  
–ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–∞—Å—Ç–æ –º–µ–Ω—è—é—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è dev/prod), —Ç–æ —Ä—É—á–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ docker-compose —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É—Ç–æ–º–∏—Ç–µ–ª—å–Ω—ã–º.

**–ö–∞–∫ –∏—Å–ø—Ä–∞–≤–∏–ª:**  
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `${VAR}` –≤ `docker-compose.yml`. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å—Ç–∞–≤–ª—è—è –¥—Ä—É–≥–æ–π `.env`.

---

## –°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

> –ê —Ç–µ–ø–µ—Ä—å –Ω–µ–º–Ω–æ–≥–æ –º–∞–≥–∏–∏: –∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–¥–Ω—è–ª–∏—Å—å –≤–º–µ—Å—Ç–µ, –Ω–æ –Ω–µ "–≤–∏–¥–µ–ª–∏" –¥—Ä—É–≥ –¥—Ä—É–≥–∞?

**–ö–∞–∫ –¥–æ–±–∏–ª—Å—è:**  
–ü–æ–º–µ—Å—Ç–∏–ª –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–µ—Ç–∏ –∏ **–Ω–µ —É–∫–∞–∑—ã–≤–∞–ª `links`** –∏–ª–∏ `depends_on` –Ω–∞–ø—Ä—è–º—É—é.

–ü—Ä–∏–º–µ—Ä:

```yaml
networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge

services:
  web:
    networks:
      - frontend

  db:
    networks:
      - backend
```

**–ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å:**  
–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã `web` –∏ `db` –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ, –Ω–æ –Ω–µ –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –ø–æ —Å–µ—Ç–∏ –Ω–∞–ø—Ä—è–º—É—é. –ö–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é —Å–µ—Ç—å. –≠—Ç–æ –∫–∞–∫ —Ä–∞–∑–Ω—ã–µ VLAN'—ã –≤ —Å–µ—Ç—è—Ö ‚Äî –∏–∑–æ–ª—è—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥—Ä–∞–π–≤–µ—Ä–∞.

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã, Docker –Ω–µ –≤–æ—Ä—á–∏—Ç:

![img.png](public/img.png)
![img_1.png](public/img_1.png)
*–ó–∞–ø—É—Å–∫ Docker Compose*

![img_2.png](public/img_2.png)
*–í—Å—ë –ø–æ–¥–Ω—è–ª–æ—Å—å, –∏ –¥–∞–∂–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ "–≤–∏–¥—è—Ç" –¥—Ä—É–≥ –¥—Ä—É–≥–∞*

![img_3.png](public/img_3.png) 
*–§—Ä–æ–Ω—Ç –∏ API –æ—Ç–≤–µ—á–∞—é—Ç ‚Äî –∂–∏–∑–Ω—å —É–¥–∞–ª–∞—Å—å*

---

## –í—ã–≤–æ–¥—ã

> "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã ‚Äî —ç—Ç–æ –∫–∞–∫ –¥–æ–º. –í –Ω—ë–º –º–æ–∂–Ω–æ –∂–∏—Ç—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ, –∞ –º–æ–∂–Ω–æ ‚Äî –≤–µ—á–Ω–æ —á–∏–Ω–∏—Ç—å —á—Ç–æ-—Ç–æ".

- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –æ–±—Ä–∞–∑–æ–≤, —á—Ç–æ–±—ã –Ω–µ —Å–ª–æ–º–∞–ª–æ—Å—å –∑–∞–≤—Ç—Ä–∞
- –ù–µ —Ö—Ä–∞–Ω–∏–º —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ –∏ Dockerfile
- –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–µ–µ –∏–∑ –æ–±—Ä–∞–∑–∞ ‚Äî –º–µ–Ω—å—à–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫
- –†–∞–±–æ—Ç–∞–µ–º —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ –∫–∞–∫ —Å "—á–µ—Ä–Ω—ã–º–∏ —è—â–∏–∫–∞–º–∏", –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞
- –ù–∞—É—á–∏–ª–∏—Å—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ç—è—Ö, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –≤ –æ–¥–Ω–æ–º compose-—Ñ–∞–π–ª–µ
